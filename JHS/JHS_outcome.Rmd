---
title: "JHS_outcome"
author: "Xiaoting Chen"
date: "2024-02-21"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyr)
library(ggplot2)
library(dplyr)
```

## JHS event

```{r}
incevtchd <- read.csv("/Users/cxt/Documents/research/CVD/Effect-of-nSES-on-CVD/Data/JHS/event_files/incevtchd.csv") %>%
  rename(years_chd = years, Status_chd = Status)

incevtstroke <- read.csv("/Users/cxt/Documents/research/CVD/Effect-of-nSES-on-CVD/Data/JHS/event_files/incevtstroke.csv") %>%
  rename(years_stroke = years, Status_stroke = Status)

incevthf <- read.csv("/Users/cxt/Documents/research/CVD/Effect-of-nSES-on-CVD/Data/JHS/event_files/incevthfder.csv") %>%
  rename(years_hf = years, Status_hf = Status, subjid = SUBJID)
```

```{r}
event_dat <- inner_join(incevtchd, incevtstroke, by = "subjid") %>%
  inner_join(incevthf, by = "subjid") %>%
  mutate(cvd_event = case_when(
    # If any of CHD, STROKE, HARDCHD, or HF, cvd_event = 1
    CHD == 1 | stroke == 1 | hardCHD == 1 | hf == 1 ~ 1,

    # If all of CHD, STROKE, HARDCHD, and hf are NA
    is.na(CHD) & is.na(stroke) & is.na(hardCHD) & is.na(hf)~ NA_integer_,

    # Otherwise
    TRUE ~ 0
  )) %>%
  mutate(cvd_event_t = case_when(
    cvd_event == 1 ~ pmin(years_chd, hardyears, years_stroke, years_hf, na.rm = TRUE),
    TRUE ~ NA_real_  # Assign NA for cases where cvd_event != 1
  )) %>%
  filter(!is.na(cvd_event)) %>%
  mutate(cvd_10y = case_when(
      cvd_event == 1 & cvd_event_t <= 10 ~ 1,
      TRUE ~ 0  # Otherwise, set cvd_10y to 0
    ))

```

```{r}
# export 

write.csv(event_dat, "../data_processed/JHS/jhs_event_combined.csv", row.names = FALSE)

```